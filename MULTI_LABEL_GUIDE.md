# 多标签打印功能使用指南

## 功能概述

多标签打印功能允许您在一张纸上同时打印多个标签，大大提高了打印效率和节省纸张。该功能支持自定义布局、纸张大小和标签数量。

## 主要特性

### 🎯 智能布局

- **自动计算标签尺寸**：根据纸张大小和标签数量自动计算每个标签的最佳尺寸
- **灵活的行列配置**：支持 1-10 行，1-6 列的标签布局
- **精确的间距控制**：可调节水平和垂直间距（0-20mm）

### 📄 纸张支持

- **标准纸张**：A4 (210×297mm)、A3 (297×420mm)、A5 (148×210mm)
- **自定义纸张**：支持自定义纸张尺寸（100-500mm）
- **多种方向**：自动适应纸张方向

### 🏷️ 标签定制

- **条形码支持**：支持 9 种条形码格式
- **字体调节**：6-16 号字体大小
- **边框选项**：可选择显示标签边框
- **文本显示**：支持标题、条形码文本和描述

## 使用步骤

### 1. 选择多标签模板

1. 在左侧控制面板中选择**模板类型**
2. 选择"多标签模板"选项
3. 系统会自动加载多标签配置界面

### 2. 配置布局参数

在"多标签布局设置"区域进行配置：

#### 纸张设置

- **纸张大小**：选择预设的纸张大小或自定义
- **纸张宽度/高度**：当选择自定义时，设置具体尺寸（单位：mm）

#### 标签布局

- **每行标签数**：设置每行放置的标签数量（1-6）
- **每列标签数**：设置每列放置的标签数量（1-10）
- **水平间距**：标签之间的水平间距（0-20mm）
- **垂直间距**：标签之间的垂直间距（0-20mm）

#### 标签样式

- **条形码高度**：设置条形码的高度（10-40mm）
- **字体大小**：设置文本的字体大小（6-16 号）
- **条形码格式**：选择条形码格式（推荐 CODE128）
- **显示条码文本**：是否在条形码下方显示文本
- **显示标签边框**：是否显示每个标签的边框

### 3. 管理打印数据

在"批量打印数据"表格中管理您的标签数据：

- **添加数据**：点击"添加数据"按钮新增标签
- **编辑数据**：直接在表格中修改标签内容
- **导入数据**：从 JSON 文件导入批量数据
- **删除数据**：删除不需要的标签数据

### 4. 预览和打印

1. **查看打印预览**：

   - 在"多标签打印预览"区域查看每页标签数和总页数
   - 点击"预览多标签"按钮查看第一页的效果

2. **开始打印**：
   - 点击"开始多标签打印"按钮
   - 系统会按页打印，每页包含配置的标签数量
   - 监控打印进度和状态

## 布局计算逻辑

### 标签尺寸计算

系统会根据以下公式自动计算每个标签的尺寸：

```
可用宽度 = 纸张宽度 - (左右边距 × 2)
可用高度 = 纸张高度 - (上下边距 × 2)

实际标签宽度 = (可用宽度 - 水平间距 × (列数 - 1)) / 列数
实际标签高度 = (可用高度 - 垂直间距 × (行数 - 1)) / 行数
```

### 标签位置计算

每个标签的位置按以下规则确定：

```
标签左边距 = 边距 + 列索引 × (标签宽度 + 水平间距)
标签顶边距 = 边距 + 行索引 × (标签高度 + 垂直间距)
```

## 常用布局配置

### A4 纸张推荐配置

#### 2×3 布局（每页 6 个标签）

- **纸张**：A4 (210×297mm)
- **行数**：3，**列数**：2
- **间距**：水平 5mm，垂直 5mm
- **标签尺寸**：约 95×90mm

#### 3×4 布局（每页 12 个标签）

- **纸张**：A4 (210×297mm)
- **行数**：4，**列数**：3
- **间距**：水平 5mm，垂直 5mm
- **标签尺寸**：约 63×67mm

#### 4×6 布局（每页 24 个标签）

- **纸张**：A4 (210×297mm)
- **行数**：6，**列数**：4
- **间距**：水平 3mm，垂直 3mm
- **标签尺寸**：约 47×45mm

### A3 纸张推荐配置

#### 3×4 布局（每页 12 个标签）

- **纸张**：A3 (297×420mm)
- **行数**：4，**列数**：3
- **间距**：水平 8mm，垂直 8mm
- **标签尺寸**：约 92×95mm

## 数据格式要求

### 标签数据结构

```json
{
  "title": "产品标签", // 标签标题
  "barcodeText": "PRD001", // 条形码内容
  "description": "产品描述" // 描述文本
}
```

### 批量数据示例

```json
[
  {
    "title": "产品 A",
    "barcodeText": "PRD001",
    "description": "产品编号 PRD001"
  },
  {
    "title": "产品 B",
    "barcodeText": "PRD002",
    "description": "产品编号 PRD002"
  }
]
```

## 打印流程

### 1. 数据分页

系统会自动将批量数据按每页标签数进行分页：

- 每页标签数 = 行数 × 列数
- 总页数 = 向上取整(总标签数 / 每页标签数)
- 最后一页不足的位置会显示为空白

### 2. 批量打印

- 按页依次打印，每页包含多个标签
- 支持设置打印间隔时间
- 实时显示打印进度和状态
- 自动处理打印错误

### 3. 错误处理

- 数据验证：检查条形码格式是否正确
- 布局检查：确保标签尺寸合理
- 打印监控：监控每页打印状态

## 性能优化建议

### 1. 数据优化

- 单次打印建议不超过 50 页
- 避免过长的标题和描述文本
- 确保条形码内容格式正确

### 2. 布局优化

- 根据标签内容调整字体大小
- 合理设置条形码高度
- 避免过小的标签尺寸

### 3. 打印优化

- 设置合适的打印间隔（建议 1-2 秒）
- 确保打印机连接稳定
- 大批量数据建议分批打印

## 故障排除

### 1. 标签内容显示不全

**原因**：标签尺寸过小或字体过大
**解决方法**：

- 减少每页标签数量
- 调小字体大小
- 增加纸张尺寸

### 2. 条形码无法扫描

**原因**：条形码高度不够或格式错误
**解决方法**：

- 增加条形码高度
- 检查条形码内容格式
- 选择合适的条形码格式

### 3. 布局错乱

**原因**：间距设置不当
**解决方法**：

- 调整水平和垂直间距
- 检查纸张尺寸设置
- 重新计算标签布局

### 4. 打印质量问题

**原因**：打印机设置或纸张问题
**解决方法**：

- 检查打印机分辨率设置
- 使用合适的标签纸
- 调整打印机驱动设置

## 高级功能

### 1. 自定义模板

您可以在 `printService.js` 中的 `getMultiLabelTemplate()` 方法中自定义标签布局：

```javascript
// 添加自定义元素
printElements.push({
  options: {
    left: baseLeft + 2,
    top: baseTop + actualLabelHeight - 12,
    height: 8,
    width: actualLabelWidth - 4,
    title: new Date().toLocaleDateString(),
    fontSize: 6,
    textAlign: "right",
    color: "#ccc",
  },
  printElementType: {
    title: `日期${labelIndex + 1}`,
    type: "text",
  },
});
```

### 2. 批量数据生成

使用编程方式生成序列标签：

```javascript
function generateSequentialLabels(prefix, start, count) {
  const labels = [];
  for (let i = 0; i < count; i++) {
    labels.push({
      title: `${prefix}标签`,
      barcodeText: `${prefix}${String(start + i).padStart(4, "0")}`,
      description: `序列号：${start + i}`,
    });
  }
  return labels;
}
```

### 3. 条形码验证

在打印前验证条形码格式：

```javascript
function validateBarcodeFormat(text, format) {
  const patterns = {
    CODE128: /^[\x00-\x7F]*$/,
    CODE39: /^[0-9A-Z\-. $/+%]*$/,
    EAN13: /^\d{13}$/,
    EAN8: /^\d{8}$/,
  };

  return patterns[format] ? patterns[format].test(text) : false;
}
```

## 技术支持

如果您在使用过程中遇到问题，请：

1. 检查浏览器控制台是否有错误信息
2. 确认打印数据格式正确
3. 验证纸张和布局设置
4. 测试打印机连接状态

## 总结

多标签打印功能为您提供了一个强大而灵活的批量标签打印解决方案。通过合理配置布局参数和优化打印流程，您可以高效地完成大量标签的打印工作。

---

**通过本指南，您可以充分利用多标签打印功能，实现高效的批量标签打印！**
