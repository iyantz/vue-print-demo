# 循环打印标签功能使用指南

## 功能概述

本功能专门用于批量打印条形码标签，支持自定义标签尺寸、条形码格式、批量数据管理以及打印进度监控。

## 主要特性

### 🏷️ 标签模板

- **可自定义标签尺寸**：支持宽度 50-200mm，高度 30-150mm
- **条形码高度调节**：20-80mm 可调
- **字体大小设置**：8-20 号字体
- **多种条形码格式**：支持 CODE128、CODE39、EAN13 等 9 种格式

### 📊 批量数据管理

- **数据表格编辑**：直接在表格中编辑标签内容
- **数据导入导出**：支持 JSON 格式的数据导入导出
- **批量数据操作**：添加、删除、复制、清空等操作

### 🖨️ 循环打印控制

- **打印间隔设置**：500-10000 毫秒可调
- **实时进度监控**：显示打印进度和当前项目
- **错误处理**：自动处理打印失败并显示错误信息
- **打印控制**：支持开始、停止打印操作

## 使用步骤

### 1. 选择标签模板

在左侧控制面板中：

1. 选择模板类型为"标签模板"
2. 系统会自动切换到标签打印模式

### 2. 配置标签参数

在"标签设置"区域配置：

- **标签宽度**：根据实际标签纸设置（默认 100mm）
- **标签高度**：根据实际标签纸设置（默认 60mm）
- **条形码高度**：调整条形码的高度（默认 30mm）
- **字体大小**：设置标签文字的字体大小（默认 10 号）
- **条形码格式**：选择合适的条形码格式（推荐 CODE128）
- **显示条码文本**：是否在条形码下方显示文本

### 3. 设置批量打印参数

在"批量打印设置"区域：

- **打印间隔**：设置每个标签之间的打印间隔（默认 1000ms）
- **批量模式**：开启批量打印功能

### 4. 管理打印数据

在"批量打印数据"表格中：

- **直接编辑**：点击表格单元格直接编辑内容
- **添加数据**：点击"添加数据"按钮新增标签
- **删除数据**：点击行末的"删除"按钮
- **复制数据**：点击"复制"按钮复制当前行数据
- **导入数据**：点击"导入数据"从 JSON 文件导入
- **导出数据**：点击"导出数据"保存为 JSON 文件

### 5. 开始打印

1. **预览标签**：点击"预览标签"按钮查看第一个标签的效果
2. **开始批量打印**：点击"开始批量打印"按钮开始循环打印
3. **监控进度**：观察进度条和打印状态
4. **停止打印**：如需中断，点击"停止打印"按钮

## 数据格式说明

### 标签数据结构

```json
{
  "title": "产品标签", // 标签标题
  "barcodeText": "PRD001", // 条形码内容
  "description": "产品编号PRD001" // 描述信息
}
```

### 批量数据示例

```json
[
  {
    "title": "产品标签",
    "barcodeText": "PRD001",
    "description": "产品编号PRD001"
  },
  {
    "title": "产品标签",
    "barcodeText": "PRD002",
    "description": "产品编号PRD002"
  },
  {
    "title": "产品标签",
    "barcodeText": "PRD003",
    "description": "产品编号PRD003"
  }
]
```

## 标签尺寸参考

### 常用标签尺寸

- **小标签**：40mm x 30mm（适合小物品）
- **中标签**：70mm x 50mm（适合一般产品）
- **大标签**：100mm x 60mm（适合大型产品）
- **长标签**：120mm x 40mm（适合长条形产品）

### 条形码高度建议

- **小标签**：15-20mm
- **中标签**：25-30mm
- **大标签**：30-40mm
- **长标签**：20-25mm

## 条形码格式选择

### CODE128（推荐）

- **优点**：支持所有 ASCII 字符，密度高
- **适用**：大多数应用场景
- **格式**：字母数字混合

### CODE39

- **优点**：简单可靠，广泛支持
- **适用**：工业应用
- **格式**：数字、大写字母、特殊符号

### EAN13

- **优点**：国际标准，商品条码
- **适用**：商品管理
- **格式**：13 位数字

### EAN8

- **优点**：短版 EAN 码
- **适用**：小包装商品
- **格式**：8 位数字

## 打印流程优化

### 1. 数据准备

- 确保条形码内容符合选定格式要求
- 避免过长的标题和描述文本
- 检查数据完整性

### 2. 参数设置

- 根据实际标签纸调整尺寸
- 设置合适的打印间隔（避免过快导致问题）
- 选择适合的条形码格式

### 3. 测试打印

- 先预览单个标签效果
- 小批量测试打印
- 确认无误后批量打印

### 4. 打印监控

- 关注打印进度
- 及时处理错误提示
- 必要时停止打印进行调整

## 常见问题解决

### 1. 条形码无法扫描

- **原因**：条形码太小或格式不正确
- **解决**：增加条形码高度，检查内容格式

### 2. 标签内容显示不全

- **原因**：标签尺寸太小或字体太大
- **解决**：调整标签尺寸或减小字体大小

### 3. 打印速度过慢

- **原因**：打印间隔设置过长
- **解决**：适当减少打印间隔时间

### 4. 批量打印中断

- **原因**：数据错误或网络问题
- **解决**：检查数据格式，重新开始打印

### 5. 数据导入失败

- **原因**：JSON 格式错误
- **解决**：检查文件格式，确保是正确的 JSON 数组

## 高级功能

### 1. 自定义标签模板

可以在 `printService.js` 中的 `getLabelTemplate()` 方法中自定义标签布局：

```javascript
// 添加更多元素到标签中
printElements: [
  // 标题
  {
    /* 标题配置 */
  },
  // 条形码
  {
    /* 条形码配置 */
  },
  // 日期
  {
    options: {
      left: 5,
      top: 45,
      height: 8,
      width: 90,
      title: new Date().toLocaleDateString(),
      fontSize: 8,
      textAlign: "right",
      color: "#999",
    },
    printElementType: {
      title: "日期",
      type: "text",
    },
  },
];
```

### 2. 批量数据生成

可以通过编程方式生成批量数据：

```javascript
// 生成序列号标签
function generateSerialLabels(prefix, start, count) {
  const labels = [];
  for (let i = 0; i < count; i++) {
    labels.push({
      title: "序列标签",
      barcodeText: `${prefix}${String(start + i).padStart(4, "0")}`,
      description: `序列号：${prefix}${String(start + i).padStart(4, "0")}`,
    });
  }
  return labels;
}

// 使用示例
const labels = generateSerialLabels("PRD", 1, 100);
```

### 3. 条形码验证

在打印前验证条形码内容：

```javascript
// 验证条形码内容
function validateBarcode(text, format) {
  const validators = {
    CODE128: () => true, // CODE128支持所有ASCII字符
    CODE39: (text) => /^[0-9A-Z\-. $/+%]*$/.test(text),
    EAN13: (text) => /^\d{13}$/.test(text),
    EAN8: (text) => /^\d{8}$/.test(text),
  };

  return validators[format] ? validators[format](text) : false;
}
```

## 性能优化建议

### 1. 批量打印优化

- 单次打印数量建议不超过 100 个
- 大批量数据分批处理
- 设置合适的打印间隔

### 2. 内存管理

- 及时清理不需要的数据
- 避免过大的标签图片
- 定期刷新页面

### 3. 网络优化

- 确保网络连接稳定
- 避免打印期间进行其他网络操作
- 使用本地数据减少网络依赖

## 技术支持

如遇到问题，请：

1. 检查浏览器控制台错误信息
2. 确认打印机连接状态
3. 验证数据格式正确性
4. 查看详细的错误提示

---

**通过以上指南，您可以充分利用循环打印标签功能，实现高效的批量标签打印！**
