# 条形码和二维码打印功能使用说明

## 功能概述

本项目已成功集成条形码和二维码打印功能，支持多种条形码格式和二维码生成选项。

## 主要功能

### 1. 条形码功能

- **支持的格式**: CODE128, CODE39, EAN13, EAN8, UPC, ITF14, MSI, pharmacode, codabar
- **可配置选项**:
  - 条形码内容
  - 条形码格式
  - 是否显示文本
  - 尺寸调整

### 2. 二维码功能

- **支持的纠错等级**: L (低), M (中), Q (高), H (最高)
- **可配置选项**:
  - 二维码内容（支持多行文本）
  - 纠错等级
  - 尺寸调整

## 使用方法

### 1. 启用条形码和二维码

在左侧控制面板中：

1. **选择模板类型**: 选择 "条码模板" 来启用条形码和二维码功能
2. **条形码设置**:
   - 打开 "启用条形码" 开关
   - 输入条形码内容
   - 选择条形码格式
   - 设置是否显示文本
3. **二维码设置**:
   - 打开 "启用二维码" 开关
   - 输入二维码内容
   - 选择纠错等级

### 2. 生成预览

点击 "生成预览" 按钮可以在左侧面板中预览生成的条形码和二维码。

### 3. 打印或导出

- **预览打印**: 点击 "预览打印" 按钮查看完整的打印效果
- **直接打印**: 点击 "直接打印" 按钮直接打印文档
- **导出 PDF**: 点击 "导出 PDF" 按钮导出为 PDF 文件

## 技术实现

### 核心库

- **条形码生成**: `jsbarcode` 库
- **二维码生成**: `qrcode` 库

### 架构设计

- **服务层**: `codeService.js` - 负责条形码和二维码的生成
- **扩展层**: `hiprintExtensions.js` - 扩展 hiprint 以支持条形码和二维码
- **打印层**: `printService.js` - 集成条形码和二维码到打印模板

### 数据流程

1. 用户输入条形码/二维码内容
2. 系统生成 base64 格式的图片数据
3. 图片数据作为图片元素添加到打印模板
4. 执行打印或导出操作

## 示例数据格式

```javascript
{
  name: "张三",
  age: 28,
  department: "技术部",
  position: "前端工程师",
  salary: "12000",
  barcodeText: "EMP001",           // 条形码内容
  qrcodeText: "员工编号：EMP001\n姓名：张三\n部门：技术部"  // 二维码内容
}
```

## 自定义配置

### 条形码配置选项

```javascript
{
  format: 'CODE128',           // 条形码格式
  width: 2,                    // 条宽
  height: 100,                 // 条高
  displayValue: true,          // 是否显示文本
  fontSize: 16,                // 字体大小
  textAlign: 'center',         // 文本对齐
  background: '#ffffff',       // 背景颜色
  lineColor: '#000000'         // 线条颜色
}
```

### 二维码配置选项

```javascript
{
  width: 200,                  // 二维码尺寸
  errorCorrectionLevel: 'M',   // 纠错等级
  margin: 1,                   // 边距
  color: {
    dark: '#000000',           // 前景色
    light: '#ffffff'           // 背景色
  }
}
```

## 常见问题

### 1. 条形码生成失败

- 检查条形码内容是否符合所选格式的要求
- 例如：EAN13 需要 13 位数字，CODE39 只支持特定字符

### 2. 二维码显示不清晰

- 增加二维码的尺寸设置
- 选择合适的纠错等级

### 3. 打印效果不佳

- 调整条形码和二维码的尺寸
- 确保打印机分辨率足够

## 扩展功能

### 添加新的条形码格式

在 `codeService.js` 中的 `getSupportedBarcodeFormats()` 方法中添加新格式。

### 自定义打印模板

在 `printService.js` 中修改 `getCodeTemplate()` 方法来调整布局。

### 数据验证

在 `codeService.js` 中的 `validateBarcodeContent()` 方法中添加更多验证规则。

## 最佳实践

1. **条形码内容**: 使用简洁的字符串，避免特殊字符
2. **二维码内容**: 可以包含较多信息，支持多行文本
3. **格式选择**: 根据实际需求选择合适的条形码格式
4. **尺寸设置**: 根据打印纸张大小调整条形码和二维码尺寸
5. **测试验证**: 打印前先预览，确保条形码和二维码可以正常扫描

## 支持的浏览器

- Chrome 70+
- Firefox 60+
- Safari 12+
- Edge 79+

## 更新日志

### v1.0.0

- 集成条形码和二维码打印功能
- 支持多种条形码格式
- 支持二维码纠错等级配置
- 添加实时预览功能
- 完善的错误处理机制
